<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>VIAJA CON NOSOTROS.COM</title>
    <link rel="icon" href="img/vuelos.jpg" />
    <style>
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
        background-image: url("img/logo.png");
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
      }

      h1,
      h2,
      h3 {
        text-align: center;
        margin-top: 30px;
      }

      section {
        max-width: 500px;
        margin: 30px auto;
        padding: 20px;
        background: #f2f2f2;
        border-radius: 10px;
        box-shadow: 0 0 10px #ccc;
      }

      input,
      button {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
      }

      form {
        margin-bottom: 30px;
      }

    .carrito {
      position: fixed;
      top: 100px;
      right: 30px;
      width: 200px;
      height: auto;
      cursor: move;
      user-select: none;
      z-index: 10;
    }


      .carrito-img {
        width: 100%;
        height: auto;
        display: block;
      }

    .carrito-links {
        position: static;
        width: 100%;
        background: rgba(0,0,0,0.6);
        padding: 10px 0;
        border-radius: 0 0 10px 10px;
        text-align: center;
        margin-top: 10px;
    }
        

      .carrito-links a {
        color: white;
        text-decoration: none;
        display: block;
        margin: 5px 0;
      }

      .carrito-links a:hover {
        text-decoration: underline;
      }

      table {
        border-collapse: collapse;
        margin: 30px auto;
        width: 80%;
      }

      th,
      td {
        padding: 8px 12px;
        border: 1px solid #ccc;
        text-align: center;
      }

      th {
        background-color: #4caf50;
        color: white;
      }

      .resultado {
        margin-top: 40px;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <!-- <div class="logo-fondo"></div>  <-- Elimina esta línea -->

    <h1 style="font-size: 3em; font-weight: bold;">VUELA CON NOSOTROS.COM</h1>

    <!-- Carrito con imagen personalizada -->
    <div class="carrito" id="carrito">
      <img src="img/iconos/carrito.png" alt="Carrito" class="carrito-img" />
      <div class="carrito-links">
        <a href="compras_realizadas.php?tipo=vuelo">Vuelo nacional</a>
        <a href="compras_realizadas.php?tipo=hotel">Hotel internacional</a>
      </div>
    </div>

    <!-- Formulario Hotel -->
    <section style="box-shadow: 0 4px 16px #aaa; background: #e9f7ef;">
      <h3 style="color: #2e8b57;">Agregar Hotel</h3>
      <form
        method="POST"
        action="insertar_hotel.php"
        onsubmit="return validarHotel()"
        style="display: flex; flex-direction: column; gap: 10px;"
      >
        <input
          type="text"
          name="nombre"
          placeholder="Nombre del Hotel"
          required
          style="border-radius: 5px; border: 1px solid #ccc;"
        />
        <input
          type="text"
          name="ubicacion"
          placeholder="Ubicación"
          required
          style="border-radius: 5px; border: 1px solid #ccc;"
        />
        <input
          type="number"
          name="habitaciones"
          id="habitaciones"
          placeholder="Habitaciones disponibles"
          min="1"
          required
          style="border-radius: 5px; border: 1px solid #ccc;"
        />
        <input
          type="number"
          step="0.01"
          name="tarifa"
          placeholder="Tarifa por noche"
          min="0"
          required
          style="border-radius: 5px; border: 1px solid #ccc;"
        />
        <input
          type="submit"
          value="Agregar Hotel"
          style="background: #2e8b57; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;"
        />
      </form>
    </section>
     
    <!-- Formulario Vuelo -->
    <section>
    <h3 style="color: #2e8b57;">Agregar Vuelo</h3>
    <form
      method="POST"
      action="insertar_vuelo.php"
      onsubmit="return validarVuelo()"
      style="display: flex; flex-direction: column; gap: 10px;"
    >
      <input
        type="text"
        name="origen"
        placeholder="Origen"
        required
        style="border-radius: 5px; border: 1px solid #ccc;"
      />
      <input
        type="text"
        name="destino"
        placeholder="Destino"
        required
        style="border-radius: 5px; border: 1px solid #ccc;"
      />
      <input
        type="date"
        name="fecha"
        required
        style="border-radius: 5px; border: 1px solid #ccc;"
      />
      <input
        type="number"
        name="plazas"
        id="plazas"
        placeholder="Plazas disponibles"
        min="1"
        required
        style="border-radius: 5px; border: 1px solid #ccc;"
      />
      <input
        type="number"
        step="0.01"
        name="precio"
        placeholder="Precio"
        min="0"
        required
        style="border-radius: 5px; border: 1px solid #ccc;"
      />
      <input
        type="submit"
        value="Agregar Vuelo"
        style="background: #2e8b57; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;"
      />
    </form>
  </section>

    <!-- Consulta avanzada en el mismo archivo -->
    <section class="resultado" style="box-shadow: 0 4px 16px #aaa; background: #e9f7ef; max-width: 600px;">
      <form method="POST" style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
        <input
          type="submit"
          name="ver_reservas"
          value="Ver Hoteles con más de 2 Reservas"
          style="background: #2e8b57; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; padding: 10px 20px;"
        />
      </form>
    <div style="margin: 30px auto; max-width: 600px;">
    <?php
    if (isset($_POST['ver_reservas'])) {
      $conexion = new mysqli("localhost", "root", "", "AGENCIA");

      if ($conexion->connect_error) {
        echo '<p>Error de conexión: ' . $conexion->connect_error . '</p>';
      } else {
        $consulta = "SELECT H.id_hotel, H.nombre, COUNT(R.id_reserva) AS total_reservas
                     FROM HOTEL H
                     JOIN RESERVA R ON H.id_hotel = R.id_hotel
                     GROUP BY H.id_hotel, H.nombre
                     HAVING total_reservas > 2";
        $resultado = $conexion->query($consulta);

        echo '<h2>Hoteles con más de 2 reservas</h2>';
        if ($resultado && $resultado->num_rows > 0) {
        echo '<table style="margin: 0 auto; width: 0px; font-size: 0.7em;">';
                  <tr>
                    <th>ID Hotel</th>
                    <th>Nombre</th>
                    <th>Total Reservas</th>
                  </tr>';
          while($fila = $resultado->fetch_assoc()) {
            echo '<tr>';
                    <td>' . htmlspecialchars($fila["id_hotel"]) . '</td>
                    <td>' . htmlspecialchars($fila["nombre"]) . '</td>
                    <td>' . htmlspecialchars($fila["total_reservas"]) . '</td>
                  </tr>';
          }
          echo '</table>';
        } else {
          echo '<p style="text-align: center">No hay hoteles con más de 2 reservas.</p>';
        }
        $conexion->close();
      }
    }
    ?>
    </section>

    <script>
      function validarHotel() {
        const habitaciones = document.getElementById("habitaciones").value;
        if (habitaciones < 1) {
          alert("Debe haber al menos una habitación disponible.");
          return false;
        }
        return true;
      }

      function validarVuelo() {
        const plazas = document.getElementById("plazas").value;
        if (plazas < 1) {
          alert("Las plazas deben ser mayores a cero.");
          return false;
        }
        return true;
      }

      const carrito = document.getElementById("carrito");
      let isDragging = false,
        offsetX,
        offsetY;

      carrito.addEventListener("mousedown", (e) => {
        isDragging = true;
        offsetX = e.clientX - carrito.offsetLeft;
        offsetY = e.clientY - carrito.offsetTop;
      });

      document.addEventListener("mousemove", (e) => {
        if (isDragging) {
          carrito.style.left = `${e.clientX - offsetX}px`;
          carrito.style.top = `${e.clientY - offsetY}px`;
        }
      });

      document.addEventListener("mouseup", () => (isDragging = false));
    </script>
  </body>
</html>
